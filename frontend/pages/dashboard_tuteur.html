<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard Tuteur</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap & Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../styles/dashboard_tuteur.css" />
    <link rel="stylesheet" href="../styles/tuteur-header.css" />
  </head>

  <body>
    <!-- ‚úÖ HEADER NAVBAR -->
    <div class="header-container">
      <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container">
          <div class="collapse navbar-collapse justify-content-center">
            <ul class="navbar-nav">
              <li class="nav-item nav-item1 mx-1 active active1">
                <a
                  class="nav-link text-white d-flex align-items-center"
                  href="#"
                >
                  <i class="bi bi-speedometer2 me-2"></i> Dashboard Tuteur
                </a>
              </li>
              <li class="nav-item nav-item1 mx-1">
                <a
                  class="nav-link text-white d-flex align-items-center"
                  href="../../backend/tuteur.php"
                >
                  <i class="bi bi-bar-chart-line-fill me-2 text-white"></i> Mes
                  stagiaires
                </a>
              </li>
              <li class="nav-item nav-item1 mx-1">
                <a
                  class="nav-link text-white d-flex align-items-center"
                  href="evaluation.html"
                >
                  <i class="bi bi-pencil-fill me-2"></i> √âvaluer Stagiaire
                </a>
              </li>
              <li class="nav-item nav-item1 mx-1">
                <a
                  class="nav-link text-white d-flex align-items-center"
                  href="historique_tuteur.html"
                >
                  <i class="bi bi-clock-history me-2"></i> Historique
                </a>
              </li>
              <li class="nav-item nav-item1 mx-1">
                <a
                  class="nav-link text-white d-flex align-items-center"
                  href="login.html"
                >
                  <i class="bi bi-box-arrow-right me-2"></i> D√©connexion
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>

    <!-- ‚úÖ PAGE AVEC SIDEBAR -->
    <div class="d-flex">
      <!-- SIDEBAR -->
      <div class="sidebar bg-dark text-white p-3">
        <h5 class="text-center mb-4">Menu</h5>
        <div class="sidebar-item dropdown-hover">
          <button class="btn btn-outline-light w-100">1</button>
          <div class="submenu">
            <a href="dashboard_tuteur.html?view=statut">Par statut</a>
            <a href="dashboard_tuteur.html?view=service">Par service</a>
            <a href="dashboard_tuteur.html?view=nom_stage">Par nom du stage</a>
            <a href="dashboard_tuteur.html?view=age">Par √¢ge</a>
            <a href="dashboard_tuteur.html?view=sexe">Par sexe</a>
          </div>
        </div>
      </div>
      <div class="sidebar-item">
        <button class="btn btn-outline-light w-100 mt-2">2</button>
      </div>
      <div class="sidebar-item">
        <button class="btn btn-outline-light w-100 mt-2">3</button>
      </div>
      <div class="sidebar-item">
        <button class="btn btn-outline-light w-100 mt-2">4</button>
      </div>
      <div class="sidebar-item">
        <button class="btn btn-outline-light w-100 mt-2">5</button>
      </div>
    </div>

    <!-- ‚úÖ CONTENU PRINCIPAL REMPLI PAR JAVASCRIPT -->
    <div class="content container mt-5" id="dashboard-content">
      <!-- Le JavaScript remplira ce bloc selon ce que tu cliques -->
    </div>

    <script src="../js/dashboard_tuteur.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const view = params.get("view") || "statut"; // d√©faut : statut

        const container = document.getElementById("dashboard-content");

        switch (view) {
          case "statut":
            container.innerHTML = `
          <h2 class="text-center mb-4">R√©partition par Statut</h2>
          <div class="row text-center">
            <div class="col-md-4">
              <div class="card shadow p-3">
                <h5>Total stagiaires</h5>
                <p id="total-stagiaires" class="fw-bold fs-4 text-primary">...</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card shadow p-3">
                <h5>Stagiaires en cours</h5>
                <p id="stagiaires-actifs" class="fw-bold fs-4 text-warning">...</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card shadow p-3">
                <h5>Stagiaires termin√©s</h5>
                <p id="stagiaires-termines" class="fw-bold fs-4 text-success">...</p>
              </div>
            </div>
          </div>
        `;
            loadStatutData();
            break;

          case "service":
            container.innerHTML = `
          <h2 class="text-center mb-4">R√©partition par Service</h2>
          <canvas id="chartService" height="100"></canvas>
        `;
            loadChartService(); // fonction plus bas
            break;

          default:
            container.innerHTML = `<p class="text-center">üîç Vue non reconnue.</p>`;
        }
      });
      function loadStatutData() {
        fetch("../../backend/stats_par_statut.php")
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              document.getElementById("total-stagiaires").textContent =
                data.total;
              document.getElementById("stagiaires-actifs").textContent =
                data.actifs;
              document.getElementById("stagiaires-termines").textContent =
                data.termines;
            }
          });
      }

      function loadChartService() {
        fetch("../../backend/stats_par_service.php")
          .then((res) => res.json())
          .then((data) => {
            const ctx = document.getElementById("chartService");
            new Chart(ctx, {
              type: "bar",
              data: {
                labels: data.labels,
                datasets: [
                  {
                    label: "Nombre de stagiaires",
                    data: data.values,
                    backgroundColor: "rgba(54, 162, 235, 0.6)",
                  },
                ],
              },
              options: {
                responsive: true,
                scales: {
                  y: { beginAtZero: true },
                },
              },
            });
          });
      }
      console.log("Vue demand√©e :", view);
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </body>
</html>
